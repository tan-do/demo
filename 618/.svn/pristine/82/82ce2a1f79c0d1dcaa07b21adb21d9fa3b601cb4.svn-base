function popPosition(t){var e=$(window).width(),i=$(window).height(),o=$(t).width(),a=$(t).height();$(t).css({left:e/2-o/2,top:i/2-a/2})}function json_encode(t){var e=this.window.JSON;if("object"==typeof e&&"function"==typeof e.stringify)return e.stringify(t);var i=t,o=function(t){var e=/[\\\"\u0000-\u001f\u007f-\u009f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,i={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};return e.lastIndex=0,e.test(t)?'"'+t.replace(e,function(t){var e=i[t];return"string"==typeof e?e:"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+t+'"'},a=function(t,e){var i="",n="    ",r=0,s="",l="",c=0,d=i,m=[],p=e[t];switch(p&&"object"==typeof p&&"function"==typeof p.toJSON&&(p=p.toJSON(t)),typeof p){case"string":return o(p);case"number":return isFinite(p)?String(p):"null";case"boolean":case"null":return String(p);case"object":if(!p)return"null";if(i+=n,m=[],"[object Array]"===Object.prototype.toString.apply(p)){for(c=p.length,r=0;c>r;r+=1)m[r]=a(r,p)||"null";return l=0===m.length?"[]":i?"[\n"+i+m.join(",\n"+i)+"\n"+d+"]":"["+m.join(",")+"]",i=d,l}for(s in p)Object.hasOwnProperty.call(p,s)&&(l=a(s,p),l&&m.push(o(s)+(i?": ":":")+l));return l=0===m.length?"{}":i?"{\n"+i+m.join(",\n"+i)+"\n"+d+"}":"{"+m.join(",")+"}",i=d,l}};return a("",{"":i})}function json_decode(str_json){var json=this.window.JSON;if("object"==typeof json&&"function"==typeof json.parse)return json.parse(str_json);var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,j,text=str_json;if(cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(t){return"\\u"+("0000"+t.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")");throw new SyntaxError("json_decode")}function getCookie(t){var e=document.cookie.indexOf(t),i=document.cookie.indexOf(";",e),o=document.cookie.substring(e+t.length+1,i>e?i:document.cookie.length);return-1==e?"":decodeURIComponent(o)}function setCookie(t,e,i,o,a,n){i=i?i:604800,i=1e3*i;var r=new Date;r.setTime(r.getTime()+i),document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+(r?"; expires="+r.toGMTString():"")+(o?"; path="+o:"/")+(a?"; domain="+a:"")+(n?"; secure":"")}function setCookieArr1(t,e,i,o,a,n){var r,s=getCookie(t);if(s&&(r=json_decode(s)),r){var l=r.length;if(l>=cookie_length_limit){var c=new Array;r[cookie_length_limit]=e;for(var d in r)if(l-1>=d){var m=parseInt(d)+1;c[d]=r[m.toString()]}r=c}else r[l]=e}else{var r=new Array;r[0]=e}var p=json_encode(r);i=i?i:604800,setCookie(t,p,i,o,a,n)}function getBooInCookieArr1(t,e){var i=getCookie(t);if(i){var o=json_decode(i);if(o)for(var a in o)if(o[a]&&o[a]==e)return!0}return!1}function setCookieArr2(t,e,i,o,a,n,r){var s,l=getCookie(t);if(l&&(s=json_decode(l)),s){var c=s.length;if(c>=cookie_length_limit){var d=new Array;s[cookie_length_limit]=new Array,s[cookie_length_limit][0]=e,s[cookie_length_limit][1]=i;for(var m in s)if(c-1>=m){var p=parseInt(m)+1;d[m]=s[p.toString()]}s=d}else s[c]=new Array,s[c][0]=e,s[c][1]=i}else{var s=new Array;s[0]=new Array,s[0][0]=e,s[0][1]=i}var u=json_encode(s);o=o?o:604800,setCookie(t,u,o,a,n,r)}function getBooInCookieArr2(t,e){var i=getCookie(t);if(i){var o=json_decode(i);if(o)for(var a in o)if(o[a]&&o[a][0]&&o[a][0]==e)return!0}return!1}function showHide(t,e,i){$(document).on("mouseover",t,function(){$(this).addClass(e),$(this).find(i).show()}),$(document).on("mouseout",t,function(){$(t).removeClass(e),$(t).find(i).hide()})}function openClose(t,e,i){if("mallNav"==i)$(t).click(function(){$(this).prev().css("height","auto"),$(this).hide(),$(this).next("a").show()}),$(e).click(function(){$(this).parent().find("ul").css("height","64px"),$(this).hide(),$(this).prev("a").show()});else if("comments"==i){for(var o=$("blockquote").length,a=0;o>a;a++){$(t).prev(".comment_con").eq(a).height();120==$(t).prev(".comment_con").eq(a).height()?$(t).eq(a).css("display","block"):$(t).eq(a).css("display","none")}$(t).click(function(){$(this).prev().css({height:"auto","max-height":"100%"}),$(this).hide(),$(this).next("a").show()})}}function init_action(){$("#comments .tab_info .comment_listBox").length>0&&$(".comment_listBox li.comment_list, .comment_listBox li.comment_list blockquote").each(function(){var t=$(this).attr("blockquote_cid"),e=$(this).find(".user_name:first").attr("usmzdmid");if($(this).hasClass("comment_list")){var i=$(this).attr("id").split("_");t=i[i.length-1]}var o='<a href="javascript:void(0);" title="打码" onclick="mosaic_show_textarea('+t+')">打码</a>',a='<a href="http://users.bgm.smzdm.com/blackroom/user_add?smzdm_id='+e+'" title="关小黑屋" target="_blank">关小黑屋</a>';(0==e||void 0==e)&&(a="");var n='<a href="javascript:void(0);" onclick="delete_comment_confirm('+t+')" title="删除">删除</a>',r='<a href="http://comments.bgm.smzdm.com/comments/info/'+t+'" title="编辑" target="_blank">编辑</a>',s=o+a+n+r;$(this).find(".dingNum:last").before(s)})}function func_atta(t){t&&void 0!=typeof t||(t="#comment"),$(t+" .atta").click(function(){if(1!=parseInt($("#log_status").val()))zhiyou_relate.popup_login_show();else{$(window).scrollTop($("#comments").offset().top-50);var t=$("#textareaComment");if(t.length>0){var e=$(this).attr("title"),o=$.trim(t.val()),a=$.trim($("#textareaComment").attr("default_data"));if(o==a)o=e+" ";else{var n=o.split(" "),r=!0;for(i=0;i<n.length;i++)if(e==n[i]){r=!1;break}r?o=e+" "+o+" ":o+=" "}return t.focus().val(o),!0}}return!0})}function func_report(obj_name){obj_name&&void 0!=typeof obj_name||(obj_name="#comment"),$(obj_name+" .jubao").each(function(){if($(this).attr("id")){var t=$(this).attr("id").split("_")[1];if(""==t||null==t||"0"==t)return!1;var e=getCookie(comment_report_cookiename);if(e){var i=json_decode(e);if(i)for(var o in i)i[o]&&i[o]==t&&has_report_omment(t)}}}).click(function(){if($(this).attr("id")){var report_cid=$(this).attr("id").split("_")[1];if(""==report_cid||null==report_cid||"0"==report_cid)return!1;var boo_in_cookie=getBooInCookieArr1(comment_report_cookiename,report_cid);if(boo_in_cookie)return setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain),popUp("","#pop-status-fail-twoLine","您已经举报过了，我们正在处理，多谢反馈！"),!1;var report_type=1,report_text="";popPosition("#pop-report");var $popReport=$("#pop_report_opinion"),$popSubmit=$("#pop_report_submit");return $popReport.find("textarea").val("").end().hide(),$popSubmit.removeAttr("disabled").removeClass().addClass("btn_login"),$("#pop-report").show(function(){$(this).find("input[type='radio']").removeAttr("checked").click(function(){var t=$(this).attr("id").split("_")[2];report_type=t,9==t?($popReport.find("textarea").val("").end().show(),$popSubmit.attr("disabled","disabled").removeClass("btn_login").addClass("btn_grey"),$popReport.find("textarea").bind("keyup mouseup",function(){var t=$(this).val().length;report_text=$popReport.find("textarea").val(),t>=10?$popSubmit.removeAttr("disabled").removeClass("btn_grey").addClass("btn_login"):$popSubmit.attr("disabled","disabled").removeClass("btn_login").addClass("btn_grey")})):(report_text="",$popReport.is(":visible")&&($popReport.hide(),$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")))})}),$("#cover").show(),popClose("#pop-report"),void $("#pop_report_submit").unbind("click").click(function(){$("#pop-report,#cover").hide(),$("#pop_report_opinion").hide(),$("#pop_report_opinion").find("textarea").val(""),$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_comment_report",data:"type="+report_type+"&content="+report_text+"&cid="+report_cid,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);0==result.error_code?(has_report_omment(report_cid),setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain),popUp("","#pop-status-success","举报成功！")):result.error_msg?popUp("","#pop-status-fail",result.error_msg):popUp("","#pop-status-fail","举报失败！")},error:function(){popUp("","#pop-status-fail","网络错误")}})})}})}function commentReport(commentid,obj){var span_aid=obj.attr("id");if(span_aid&&void 0!=span_aid&&void 0!=typeof span_aid){var report_cid=span_aid.split("_")[1];if(""==report_cid||null==report_cid||"0"==report_cid)return!1;var boo_in_cookie=getBooInCookieArr1(comment_report_cookiename,report_cid);if(boo_in_cookie)return setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain),popUp("","#pop-status-fail-twoLine","您已经举报过了，我们正在处理，多谢反馈！"),!1;var report_type=1,report_text="";return popPosition("#pop-report"),$("#pop-report").css({position:"fixed",top:"50%",left:"50%","margin-left":"-240px","margin-top":"-165px"}).show(function(){$("#pop_report_opinion").hide(),$(this).find("input[type='radio']").removeAttr("checked").click(function(){var t=$(this).attr("id").split("_")[2];report_type=t,9==t?($("#pop_report_opinion").show(),$("#pop_report_submit").attr("disabled","disabled").addClass("btn_grey"),$("#pop_report_opinion").find("textarea").show().bind("keyup mouseup",function(){var t=$(this).val().length;report_text=$("#pop_report_opinion").find("textarea").val(),t>=10?$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login"):$("#pop_report_submit").attr("disabled","disabled").addClass("btn_grey")})):(report_text="",$("#pop_report_opinion").is(":visible")&&($("#pop_report_opinion").hide().find("textarea").hide(),$("#pop_report_submit").removeAttr("disabled").removeClass("btn_grey").addClass("btn_login")))})}),$("#cover").show(),popClose("#pop-report"),$("#pop_report_submit").unbind("click").click(function(){return $("#pop-report,#cover").hide(),$("#pop_report_opinion").hide(),$("#pop_report_opinion").find("textarea").val(""),$(this).attr("disabled","disabled").addClass("btn_grey"),$(".pop_report_opinion p").html("最少输入10个字").attr("class","grey"),$.ajax({type:"POST",url:"/user/comment/ajax_report",data:"type="+report_type+"&content="+report_text+"&cid="+report_cid,dataType:"json",success:function(data){$(this).removeAttr("disabled").removeClass("btn_grey").addClass("btn_login");var result=eval(data);0==result.error_code?(has_report_omment(report_cid),$("#report_"+report_cid).removeAttr("onclick").html("已举报"),setCookieArr1(comment_report_cookiename,report_cid,604800,"/",smzdm_domain),popUp("","#pop-status-success","举报成功！")):result.error_msg?popUp("","#pop-status-fail",result.error_msg):popUp("","#pop-status-fail","举报失败")},error:function(){popUp("","#pop-status-fail","网络错误")}}),$(this).removeAttr("disabled").removeClass("btn_grey").addClass("btn_login"),!1}),!1}}function has_report_omment(t){$("#comment .tab_info .comment_listBox li #report_"+t).removeAttr("onclick").addClass("comment-report").html("已举报")}function get_rating_num(t,e,i){var o="cdc_support_"+e;0==i&&(o="cdc_oppose_"+e);var a=$("#li_comment_"+t+" #"+o+":first span").html();if(a){var n=a.split("(")[1];a=n.split(")")[0],a=a?parseInt(a):0}else a=0;return a}function has_rating_omment(t,e,i,o){1==e?($("#comment .tab_info .comment_listBox li #cdc_support_"+t).removeAttr("onclick").addClass("current").html("顶<span>("+i+")</span>"),$("#comment .tab_info .comment_listBox li #cdc_oppose_"+t).removeAttr("onclick").removeClass("current")):($("#comment .tab_info .comment_listBox li #cdc_support_"+t).removeAttr("onclick").removeClass("current"),$("#comment .tab_info .comment_listBox li #cdc_oppose_"+t).removeAttr("onclick").addClass("current").html("踩<span>("+o+")</span>"))}function init_smile(){var t=$.trim($("#textareaComment").attr("default_data"));return $(".icon-small").each(function(){$(this).click(function(){if($(".smileLayerBg").hide(),"1"==$(this).attr("isclick"))$(this).removeAttr("isclick");else{$(".icon-small").each(function(){$(this).removeAttr("isclick")}),$(this).attr("isclick","1");var t=$(this).parent();t.find(".smileLayerBg").show(),t.find(".smileLayerBg .smileBox").hide().eq(0).show(),t.find(".smileLayerBg .smilePage a").removeAttr("class").eq(0).attr("class","current")}})}),$(".smilePage a").click(function(){$(this).addClass("current").siblings().removeClass("current"),$(".smileBox").hide().eq($(".smilePage a").index(this)).show()}),$(".smileLayerBg li a").each(function(){$(this).click(function(){var e=$(this).parent().parent().parent().parent(),i=e.parent().parent().find("textarea:first");e.find(".smileLayerBg").css("display","none"),e.find(".icon-small").removeAttr("isclick");var o=i.attr("default"),a=i.val();a==t&&(a="");var n=a;if(o)var n=a.replace(o,"");i.val(n),i.insertContent($(this).attr("default-data"))})}),!1}function init_comment_rating(t){var e=getCookie(comment_rating_cookiename);e&&(t&&void 0!=typeof t||(t="#comment"),$(t+" .dingNum").each(function(){if($(this).attr("id")){var t=$(this).attr("id").split("_")[2];if(""==t||null==t||"0"==t)return!1;var i=json_decode(e);if(i)for(var o in i)i[o]&&i[o][0]&&i[o][0]==t&&("1"==i[o][1]?($("#comment .tab_info .comment_listBox li #cdc_support_"+t).removeAttr("onclick").removeClass("current").addClass("current"),$("#comment .tab_info .comment_listBox li #cdc_oppose_"+t).removeAttr("onclick").removeClass("current")):($("#comment .tab_info .comment_listBox li #cdc_support_"+t).removeAttr("onclick").removeClass("current"),$("#comment .tab_info .comment_listBox li #cdc_oppose_"+t).removeAttr("onclick").removeClass("current").addClass("current")))}}))}function comment_rating_ajax(type,rating,comment_id,pid,licid){var dingnum=get_rating_num(licid,comment_id,1),cainum=get_rating_num(licid,comment_id,0),boo_in_cookie=getBooInCookieArr2(comment_rating_cookiename,comment_id);return boo_in_cookie?(has_rating_omment(comment_id,rating,dingnum,cainum),setCookieArr2(comment_rating_cookiename,comment_id,rating,604800,"/",smzdm_domain),alert("您已打分"),!1):void $.ajax({type:"GET",url:zhiyou_relate.baseUrl+"user/comment/ajax_rating",data:"comment_id="+comment_id+"&rating="+rating,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);0==rating?cainum+=1:dingnum+=1,has_rating_omment(comment_id,rating,dingnum,cainum),0==result.error_code&&setCookieArr2(comment_rating_cookiename,comment_id,rating,604800,"/",smzdm_domain)}})}function show_confirm(){$("#pop-tips").css({left:"50%","margin-left":"-240px",top:"50%","margin-top":"-115px"}).show(),$("#cover").show(),$("#layerBtnL").removeAttr("onclick"),$("#cover").on("click",function(){close_submit_confirm()})}function del_comment_confirm(t){show_confirm(),$("#layerBtnL").bind("click",function(){close_submit_confirm(),del_comment(t,0)})}function del_comment(t,e){$.ajax({type:"POST",url:zhiyou_relate.baseUrl+"user/comment/ajax_del_comment",data:"comment_id="+t+"&operator="+e,dataType:"jsonp",jsonp:"callback",success:function(e){0==e.error_code?(void 0!=typeof $("#div_comment_"+t)&&$("#div_comment_"+t).remove(),popUp("","#pop-status-success","删除成功")):e.error_msg?popUp("","#pop-status-fail",e.error_msg):popUp("","#pop-status-fail","操作失败")},error:function(){popUp("","#pop-status-fail","网络错误")}})}function delete_comment_confirm(t){window.confirm("确定删除该评论？")&&commentDelete(t,1)}function commentDelete(t,e){$.ajax({type:"POST",url:zhiyou_relate.baseUrl+"user/comment/ajax_del_comment",data:"comment_id="+t+"&operator="+e,dataType:"jsonp",jsonp:"callback",success:function(e){0==e.error_code&&($(".comment_listBox").find("#li_comment_"+t).remove(),$(".comment_listBox").find("[blockquote_cid='"+t+"']").remove(),popUp("","#pop-status-success","删除成功"))}})}function clearReplyCss(){$("#quickComment").val(""),$(".textarea_quick").height("auto")}function commentQuickReply(t){$(t).click(function(){if(1!=parseInt($("#log_status").val()))zhiyou_relate.popup_login_show();else{clearReplyCss();var t=$("#quickReply"),e=0;$(this).attr("id")&&(e=$(this).attr("id").split("_")[2],(""==e||null==e||"0"==e||0==e)&&(e=0),t.find("#parentid").val(e));var i=$(this).parent().parent(".comment_conWrap").find(".blankDiv");""==$(i).html()?($(i).html(t),$("#quickReply").show(),$(this).parent(".comment_action").css({display:"block",visibility:"visible"})):$("#quickReplyDiv").html(t)}})}function visibleOrNot(t,e,i){$(t).hover(function(){(i="visibility")?$(this).children().find(e).css("visibility","visible"):(i="display")&&$(this).children().find(e).css("display","block")},function(){(i="visibility")?$(this).children().find(e).css("visibility","hidden"):(i="display")&&$(this).children().find(e).css("display","none")})}function popClose(t){$(t).find(".pop-close").click(function(){$(t).hide(),$("#cover").hide()}),$("#cover").click(function(){$(t).hide(),$("#cover").hide()})}function popUp(t,e,i,o){""!=t?$(t).click(function(){popPosition(e),$(e).show(),$("#cover").show(),popClose(e)}):o?($(e).find(".pop_info").html(i),popPosition(e),$(e).show(),$("#cover").show(),popClose(e)):($(e).find(".pop_info").html(i),popPosition(e),$(e).show(),$("#cover").show(),setTimeout(function(){$(e).hide(),$("#cover").hide()},2e3),popClose(e))}function comment_share_to_sina(t){return $(t).click(function(){var t=0;if($(this).hasClass("icon-rightframe")){t=1;var e="no";$("#comments .comment_share i.check").removeClass("icon-rightframe")}else{t=0;var e="yes";$("#comments .comment_share i.check").addClass("icon-rightframe")}$.ajax({type:"POST",url:"/ajax_set_weibo_connect",data:"isconnect="+e,dataType:"json",success:function(e){return 0!=e.error_code&&(popUp("","#pop-status-fail",e.error_msg),t?$("#comments .comment_share i.check").addClass("icon-rightframe"):$("#comments .comment_share i.check").removeClass("icon-rightframe")),!0}})}),!1}function on_check_comment_page(t,e,i){var o=$(i).parent().parent().find(".jumpToPage #input_num").val(),a=/^[1-9]+[0-9]*]*$/;return a.test(o)?(0>=o&&(o=1),o>t&&(o=t),location.href=e+"#comments",o>=1&&(location.href=e+"p"+o+"#comments")):alert("请输入有效数字！"),!0}function show_floors(t,e,i,o,a){if(!t||void 0==typeof t||!i||void 0==typeof i||"New"!=i&&"Hot"!=i)return void popUp("","#pop-status-fail","网络错误！");void 0==typeof a&&(a=1);var n=$("#commentTabBlock"+i+" #li_comment_"+t+" .blockquote_wrap");n.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);">加载中，请稍候。。。</a>'),e&&void 0!=typeof e&&o&&void 0!=typeof o||n.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);">网络错误，请刷新重试</a>');var r=$("#quickReply"),s=$("#is_bgm").val();$.ajax({type:"GET",url:zhiyou_relate.baseUrl+"user/comment/ajax_show_floors",data:"comment_id="+t+"&article_id="+e+"&channel_id="+o,dataType:"jsonp",jsonp:"callback",success:function(l){if(l.error_code>0)return void n.find(".comment_showAll").html('<a class="a_underline" href="javascript:void(0);" onclick="show_floors('+t+","+e+", '"+i+"', '"+o+"', "+a+')">网络错误，请重试</a>');if(a)var c=comment_tpl.item;else var c=comment_tpl.item_no_atta_reply;var d=new StringBuilder("").onMultiAppendBefore(function(t){t.li_comment_id=l.data.li_comment_id,t.article_id=l.data.article_id,t.channel_id=l.data.channel_id,t.user_display_name="",t.atta="",t.home_ta?t.user_display_name='<a class="a_underline user_name" target="_blank" href="'+t.home_ta+'" usmzdmid="'+t.smzdm_id+'">'+t.display_name+t.post_author+"</a>：<p>"+t.content+"</p>":t.user_display_name='<span class="grey">'+t.display_name+t.post_author+"</span>：<p>"+t.content+"</p>",1!=t.is_anonymous&&(t.atta='<a class="atta" href="javascript:void(0);" title="@'+t.display_name+'">@TA</a>')}).appendMultiFormat(c,l.data.comment_rows).toString();n.html(d),visibleOrNot(".operate_box",".noGoods","visibility"),visibleOrNot("blockquote",".comment_action","display"),commentQuickReply(n.find(".reply")),s&&void 0!=typeof s&&n.find("blockquote").length>0&&n.find("blockquote").each(function(){var t=$(this).attr("blockquote_cid"),e=$(this).find(".user_name:first").attr("usmzdmid"),i='<a href="javascript:void(0);" title="打码" onclick="mosaic_show_textarea('+t+')">打码</a>',o='<a href="http://users.bgm.smzdm.com/blackroom/user_add?smzdm_id='+e+'" title="关小黑屋" target="_blank">关小黑屋</a>';(0==e||void 0==e)&&(o="");var a='<a href="javascript:void(0);" onclick="delete_comment_confirm('+t+')" title="删除">删除</a>',n='<a href="http://comments.bgm.smzdm.com/comments/info/'+t+'" title="编辑" target="_blank">编辑</a>',r=i+o+a+n;$(this).find(".dingNum:last").before(r)});var m=$("#quickReplyDiv");""==$.trim(m.html())&&(r.find("#parentid").val(0),m.html(r)),init_comment_rating("#li_comment_"+t+" .blockquote_wrap"),func_atta("#li_comment_"+t+" .blockquote_wrap"),func_report("#li_comment_"+t+" .blockquote_wrap")}})}function mosaic_show_textarea(cid){$("#pop-mosaic").remove();var article_id=$.trim($("#commentform #pid").val()),channel_id=$.trim($("#commentform #type").val());return $.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_content/",data:"comment_id="+cid+"&article_id="+article_id,dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(0!=result.error_code)return alert(result.error_msg),!1;var old_content=result.data,html_txt='<div class="pop pop_main_box" id="pop-mosaic" style="display:block;margin-left:-240px;margin-top:-138px;"><i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i><div class="pop-title"><div class="pop_name">打码</div></div><div class="pop-content"><div class="pop_width_420"><form id="commentform_'+cid+'"><input type="hidden" name="comment_id" value="'+cid+'" readonly="readonly" /><input type="hidden" name="article_id" value="'+article_id+'" readonly="readonly" /><input type="hidden" name="channel_id" value="'+channel_id+'" readonly="readonly" /><textarea name="old_content" id="old_content" readonly="readonly" style="display:none;">'+old_content+'</textarea><textarea name="content" id="txt_content_'+cid+'" class="textarea" id="mosaic-textarea" cols="60" rows="5">'+old_content+'</textarea><div class="a_blockBox"><a href="javascript:void(0);" class="a_redBlock" id="mosaicbtn_'+cid+'" onclick="mosaic_comment('+cid+')">打&nbsp;&nbsp;码</a></div></form></div></div></div>',cover=$("#cover");return cover.css("display","block"),cover.click(function(){$(this).hide(),$("#pop-mosaic").hide()}),$("#comment").after(html_txt),$("#pop-mosaic").delegate(".pop-close","click",function(){$("#pop-mosaic").hide(),cover.css("display","none")}),!0},error:function(){alert("网络错误")}}),!0}function get_select_txt(t){var e=document.getElementById(t),i="";if(document.selection){var o=document.selection.createRange();o.text.length>0&&(i=o.text)}else if(e.selectionStart||"0"==e.selectionStart){var a=e.selectionStart,n=e.selectionEnd;a!=n&&(i=e.value.substring(a,n))}return i}function mosaic_comment(cid){var mosaic_pre="〖「【《",mosaic_suf="》】」〗",mosaic_btn=$("#mosaicbtn_"+cid),txt_obj=$("#txt_content_"+cid);txt_obj.attr("disabled","disabled"),mosaic_btn.attr("disabled","disabled").html("打码中");var con=$.trim(txt_obj.val()),old_con=con,have_mosaic=con.indexOf(mosaic_pre)>=0||con.indexOf(mosaic_suf)>=0,sel_txt=get_select_txt("txt_content_"+cid),con_len=strlen(con);if(con_len>900)return alert("该评论内容过长，请去后台操作"),txt_obj.removeAttr("disabled"),mosaic_btn.removeAttr("disabled").html("打码"),!1;if(sel_txt){var newcon=$.trim(txt_obj.val());if(newcon.indexOf(mosaic_pre)>=0||newcon.indexOf(mosaic_suf)>=0){if(!confirm("已经有打码内容，请注意不要嵌套打码"))return txt_obj.removeAttr("disabled"),mosaic_btn.removeAttr("disabled").html("打码"),!0;txt_obj.insertContent(mosaic_pre+sel_txt+mosaic_suf)}else txt_obj.insertContent(mosaic_pre+sel_txt+mosaic_suf)}else{var regObj={"〖「【《":"","》】」〗":""};for(reg in regObj)con=con.replace(new RegExp(reg,"g"),regObj[reg]);txt_obj.val(con)}return txt_obj.removeAttr("disabled"),mosaic_btn.removeAttr("disabled").html("打码"),$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_edit/",data:$("#commentform_"+cid).serialize(),dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);return 0!=result.error_code?(alert(result.error_msg),!1):($(".p_content_"+cid).html(result.data),void $("#pop-mosaic").find("#old_content").val(con))},error:function(t){popUp("","#pop-status-fail","网络错误")}}),!0}function strlen(t){for(var e=0,i=0;i<t.length;i++){var o=t.charCodeAt(i);o>=1&&126>=o||o>=65376&&65439>=o?e++:e+=2}return e}function vote_by_post_comment(t,e,i){if(("os"==i||"exp"==i)&&vote_pid==e&&"undefined"!=typeof t&&""!=t&&0!=t){var o=document.URL,a=smzdm_site_domain+"youhui/"+e;if(o.indexOf(a)>=0){var n=$("#respond").offset().top;$(window).scrollTop(n-300)}else setCookie(vote_id_cookie_key,t,30),setCookie(vote_type_cookie_key,i,30),window.open(a+"#comments","_blank");return show_vote_div(t,i),!1}}function show_vote_div(t,e){$("#vote_id").val(t),$("#vote_type").val(e);var i=$("#hidden_vote_div");i&&i.css("display","").html("");var o=$("#vote_"+e+"_"+t).html();return $("#hidden_vote_div").css("display","block").html('<div id="cdc_vote_div" class="voteDiv" style="margin: -5px 10px 10px 0px; color: rgb(187, 2, 0); padding-left: 74px; width: 610px; line-height: 1.6em;">请填写推荐理由，提交后即可为《'+o+"》投票。</div>"),!1}function cancle_vote(){$("#vote_id").attr("value",0),$("#vote_type").attr("value","");var t=$("#hidden_vote_div");t&&t.css("display","none").html("")}function formatDate(t){var e="-",i=":",o=t.getMonth()+1,a=t.getDate();o>=1&&9>=o&&(o="0"+o),a>=0&&9>=a&&(a="0"+a);var n=t.getFullYear()+e+o+e+a+" "+t.getHours()+i+t.getMinutes()+i+t.getSeconds();return n}function add_faxian_icon(t,e,i,o){if(t.length>0&&e.length>0&&i.length>0&&o.length>0&&t>=e&&i>=t){var a='发现<img src="'+o+'" style="position:absolute;top:3px;left:72%;z-index: 2;">';$(".navBar a[href='http://faxian.smzdm.com/']").html(a)}}function tabCommon(t,e,i,o,a){"click"==a?$(t).delegate(e,"click",function(){$(this).addClass(o).siblings().removeClass(o),$(i).hide().eq($(t).find(e).index(this)).show()}):"hover"==a&&$(t).delegate(e,"mouseover",function(){$(this).addClass(o).siblings().removeClass(o),$(i).hide().eq($(t).find(e).index(this)).show()})}function deleteCookie(t){var e=getCookie(t);setCookie(t,e,-1*(new Date).getTime()/1e3,"/"),setCookie(t,e,-1*(new Date).getTime()/1e3,"/",HIS_DOMAIN)}function deleteCookieInArr(t,e){var i=getCookie(t);if(""!==i){var o=i.split(",");-1!==$.inArray(""+e,o)&&(o.splice($.inArray(""+e,o),1),setCookie(t,o.join(","),-1*(new Date).getTime()/1e3,"/"),setCookie(t,o.join(","),null,"/",HIS_DOMAIN))}}function setCookieInArr(t,e,i,o,a,n){var r=getCookie(t);if(""!==r){var s=r.split(",");-1==$.inArray(""+e,s)&&(s.push(e),setCookie(t,s.join(","),i,o,a,n))}else setCookie(t,e,i,o,a,n)}var zhiyou_relate={baseUrl:"http://zhiyou.smzdm.com/",loginUrl:"https://zhiyou.smzdm.com/",iframe_url:"https://zhiyou.smzdm.com/user/login/window/#redirect_url=",init:function(){$(function(){var t=formatDate(new Date);add_faxian_icon(t,"2016-07-11 00:00:00","2016-07-25 00:00:00","http://res.smzdm.com/images/2016/0711/meitao/meitao.png")})},popup_login_init:function(t){var e=window.location.href;void 0!=t.redirect_url&&(e=t.redirect_url),zhiyou_relate.iframe_url="https://zhiyou.smzdm.com/user/login/window/#redirect_url="+encodeURIComponent(e);var i='<div class="pop" id="pop-login-new" style="display:none;margin-left:-240px;top:30%;"><i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i><div class="pop-title"><div class="pop_name">登录</div><a href="'+zhiyou_relate.loginUrl+'user/register/mobile/" class="a_underline" _hover-ignore="1">注册</a></div><div class="pop-content"><iframe id="zhiyou_login_window_iframe" frameborder="0" style="width:315px;height:310px;" src="" scrolling="no"></iframe></div></div><div id="cover" style="display: none;"></div>',o="",a="";$("#pop-login-new").length<=0&&$("#footer").after(i),o=$("#pop-login-new"),a=$("#cover"),$(document).on("click",".zhiyou_login, .J_login_trigger",function(){zhiyou_relate.popup_login_show()}),$("#pop-login-new").delegate(".pop-close","click",function(){o.hide(),a.hide(),zhiyou_relate.popup_login_refresh()}),$(document).on("click","#cover",function(){o.hide(),a.hide(),zhiyou_relate.popup_login_refresh()})},popup_login_refresh:function(){var t=$("#zhiyou_login_window_iframe"),e=t.attr("src");t.attr("src",""),setTimeout(function(){t.attr("src",e)},0)},popup_login_show:function(){"function"==typeof call_client_login&&call_client_login();var t=$("#zhiyou_login_window_iframe"),e=t.attr("src");return e||t.attr("src",zhiyou_relate.iframe_url),$("#pop-login-new").show(),$("#cover").show(),!1},request_zhiyou_info:function(t){var e=this,i=e.baseUrl;"https:"===window.location.protocol&&(i=i.replace(/http/g,"https"));var o=i+"user/info/jsonp_get_current";$.ajax({type:"get",url:o,data:"",dataType:"jsonp",jsonp:"callback",success:function(i){zhiyou_relate.user_info=i,i.smzdm_id=parseInt(i.smzdm_id),e.user_info_default_callback(i),"function"==typeof t&&i.smzdm_id&&t(i),e.extra_user_info_callback(i)},error:function(){}})},user_info:{},bgm:{},user_info_default_callback:function(t){if(t.smzdm_id){t.bgm&&!$.isEmptyObject(t.bgm)&&(zhiyou_relate.bgm=t.bgm);var e=(t.smzdm_id,t.nickname),i=t.unread,o=t.logo,a=t.capabilities,n=t.avatar.split("small"),r="undefined"!=typeof n[0]?n[0]:"";"undefined"!=typeof n[1]&&(r+="middle"+n[1]);var s=zhiyou_relate.baseUrl+"user",l=t.point,c=t.gold,d="",m=t.checkin,p=t.comment_sync_sina;if($("body").append('<input id="log_status" type="hidden" value="1" />'),""!=a&&(a.administrator||a.editor||a.pinglun||a.edit_posts||a.moderate_comments)&&($("body").append('<input type="hidden" id="authority" value="editor" />'),$("#authority").val("all")),$(".J_login_trigger").parent().hide(),$(".J_user_entry").show(),$(".J_nav_username").html(t.nickname),$("#user_info").length>0){$("#user_info").attr("class","userInfo user_signIn"),$("#sign_login").hide(),$("#user_info_avatar").attr({src:r,alt:e}).unwrap("span").wrap('<a href=" '+s+' " class="userPic" target="_blank"></a>'),$("#user_info_name").html('<a href=" '+s+' " title=" '+e+' " target="_blank">'+e+"</a>"+o.medal+o.zhongce_grade+o.goldbl+" "+o.rank),$("#user_info_score").find("em").length>0?$("#user_info_score").find("em").html(l).end().next("a").andSelf().show():$("#user_info_score").html("积分:<em>"+l+"</em>"),$("#user_info_gold").find("em").length>0?$("#user_info_gold").find("em").html(c).end().next("a").andSelf().show():$("#user_info_gold").html("金币:<em>"+c+"</em>");var u=parseInt($("#user_info").attr("needMobileTips"));$("#user_info_tosign").unbind("click").bind("click",zhiyou_relate.set_checkin),m.has_checkin&&($("#user_info_tosign").html("已签到"+m.daily_checkin_num+"天").removeClass("signScore").addClass("signScored").removeClass("zhiyou_login").unbind("click"),1!=u&&$("#user_info_tosign").attr("href","http://www.smzdm.com/qiandao/")),$("#user_info_tosign").removeClass("zhiyou_login");var _=$("#channel").val();if("index"!=_){var h=m.slogan;$(".scoreBox").after(h)}}if(d&&1==d?($("#comment_avatar").attr({src:no_avatar,alt:"匿名用户"}).unwrap("span").wrap('<a href="javascript:void(0);" class="userPic"></a>'),$("#comment_avatar").parent(".userPic").after(' <span class="comment_nickName grey">匿名用户</span> ')):($("#comment_avatar").attr({src:r,alt:e}).unwrap("span").wrap('<a href=" '+s+' " class="userPic" target="_blank" title=" '+e+' "></a>'),$("#comment_avatar").parent(".userPic").after(' <a href=" '+s+' " class="comment_nickName a_underline" target="_blank"  title=" '+e+' ">'+e+"</a> ")),$(".comment_switch").show(function(){p&&$("#commentform").find(".check").length>0?$("#comments .comment_share i.check").addClass("icon-rightframe"):p&&$("#commentform").find(".check").length>0&&$("#comments .comment_share i.check").removeClass("icon-rightframe")}),"0"!=i.notice.num||"0"!=i.pm.num||"0"!=i.comment.num){var f=parseInt(i.notice.num)+parseInt(i.pm.num);if(0!=f){var v=i.notice.url;parseInt(i.notice.num)<=0&&(v=i.pm.url),$(".J_notice_message").attr("href",v).find("em").html(f),f>99&&(f="99+"),$(".J_menu_message").attr("href",v).css("position","relative").html('我的消息<span style="position: absolute;background: #f04848;width: 6px;height: 6px;top: 3px;right: 8px;border-radius: 50%;"></span>')}else $(".J_notice_message").hide();
if(0!=i.comment.num){var g=i.comment.url;$(".J_notice_comment").attr("href",g).find("em").html(i.comment.num),i.comment.num>99&&(i.comment.num="99+"),$(".J_menu_comment").attr("href",g).css("position","relative").html('我的评论<span style="position: absolute;background: #f04848;width: 6px;height: 6px;top: 3px;right: 8px;border-radius: 50%;"></span>')}else $(".J_notice_comment").hide();$(".J_notice").show().find(".z-icon-cross,.icon-cross-lighter").click(function(){$(".J_notice").hide()}),$(".J_notice").slideDown("slow")}else $(".J_notice").hide();$("#comment_tips").remove(),$("#textareaComment").removeClass("zhiyou_login"),$(".noLogin").removeClass("noLogin");var y=$("#textareaComment").attr("default_data");$("#textareaComment").unbind("click").val(y).focus(function(){$(this).val()==y&&$(this).val(""),$(this).css("color","#666")}).blur(function(){""==$(this).val()&&$(this).val(y).css("color","#ccc")}).change(function(){$("#textCommentSubmit").removeAttr("disabled")}),$("#textCommentSubmit").removeAttr("disabled").removeClass("btn_subGrey").addClass("btn_sub");var b=t.banright;if(b.length>0)for(var k=0,w=b.length;w>k;k++)if(1==b[k]){var x=t.bantips;$("#textareaComment").html("").attr("disabled","disabled"),$("#comment_error").html(x).show(),$("#textCommentSubmit").removeClass("btn_sub").addClass("btn_subGrey").attr("disabled","disabled"),$(".comment_switch").hide(),$(".atta,.reply").unbind("click");break}showHidenNotice(".login_Info","#chief_notice"),showHidenNotice(".submission","#chief_notice");var C=parseInt(t.login_error_num);if(C>=3){var j=$("#captcha_img").attr("data-src");$("#captcha_img").attr("src",j),$(".captcha_switch").show()}if(t.close_comment_enter&&($("#textareaComment").html("").attr("disabled","disabled"),$("#textCommentSubmit").removeClass("btn_sub").addClass("btn_subGrey").attr("disabled","disabled"),$(".comment_switch").hide(),$(".atta,.reply").unbind("click")),t.is_use_captcha){var j=$("#captcha_img").attr("data-src");$("#captcha_img").attr("src",j),$(".captcha_switch").show()}t.bgm&&t.bgm.permission&&t.bgm.permission.commentpermission&&(init_action(),$("#comment").append('<input type="hidden" readonly="readonly" id="is_bgm" name="is_bgm" value="1" />'))}else zhiyou_relate.footer_login_layer_init()},set_checkin:function(){$("#user_info_tosign").unbind("click"),$.ajax({type:"get",url:zhiyou_relate.baseUrl+"user/checkin/jsonp_checkin",dataType:"jsonp",jsonp:"callback",success:function(t){var e=t.error_code,i=t.error_msg;t.data;0==e?window.location.href="http://www.smzdm.com/qiandao/":popUp("","#pop-status",i["public"])},error:function(){$("#user_info_tosign").bind("click",zhiyou_relate.set_checkin)}})},add_favorite:function(t,e,i){var o=this,a=o.baseUrl+"user/favorites/";$.ajax({type:"get",url:a+"jsonp_favorite",data:{article_id:t,channel_id:e},dataType:"jsonp",jsonp:"callback",success:function(i){var n={3:"youhui",6:"news",11:"yuanchuang",7:"zhongce",8:"pingce",16:"2"};0==i.error_code?($("#pop-collect .pop_info_show a:first").attr("href",a+n[e]),7==e?e=8:8==e&&(e=7),popPosition("#pop-collect"),$("#pop-collect").show(),$("#cover").show(),popClose("#pop-collect"),$("a[id='collect_"+e+"_"+t+"']").each(function(){$(this).attr("class","fav current");var t=Number($(this).find("em").html())+1;0>t&&(t=0),$(this).find("em").html(t)}),popUp("","#pop-collect","")):2==i.error_code?($("#pop-nocollect .pop_info_show a:first").attr("href",a+n[e]),7==e?e=8:8==e&&(e=7),popPosition("#pop-nocollect"),$("#pop-nocollect").show(),$("#cover").show(),popClose("#pop-nocollect"),$("a[id='collect_"+e+"_"+t+"']").each(function(){$(this).attr("class","fav");var t=Number($(this).find("em").html())-1;0>t&&(t=0),$(this).find("em").html(t)}),popUp("","#pop-nocollect","")):5==i.error_code?o.popup_login_show():6==i.error_code},error:function(){}})},init_favorite_by_cookie:function(){$(".fav").each(function(){var t=new Array([3,"youhui"],[6,"news"],[8,"test"],[7,"test_probation"],[11,"yuanchuang"],[16,"second"]),e=$(this).attr("id");if("undefined"!=typeof e){var o=e.split("_"),a=o[2],n=o[1];for(i=0;i<t.length;i++){var r=getCookie("smzdm_collection_"+t[i][1]),s=[];if(r)var s=r.split(",");n==t[i][0]&&$.inArray(a,s)>-1&&$(this).attr("class","fav current")}}})},scored:function(t,e){var i=$(t);i.find("a").hasClass(e)&&(i.mouseover(function(){$(this).find("."+e).css("display","none"),$(this).find(".scoredInfo").css("display","block")}),i.mouseout(function(){$(this).find("."+e).css("display","block"),$(this).find(".scoredInfo").css("display","none")}))},zhi_list_callback:function(t,e,i,o,a){if(1==o){var n=$("#rating_worthy_"+e);if(n.find(" .scoreAnimate").fadeIn().animate({top:"-30px"},"normal").fadeOut(300),n.find("em").length)var r=parseInt($.trim(n.find("em").html()));else var s=n.find(" .scoreTotal").text(),l=s.split(" "),r=parseInt(l[1]);var r=r+1;n.find(" .scoreTotal").length?n.find(" .scoreTotal").html("<b>值</b> "+r):n.find("em").html(r)}else{var c=$("#rating_unworthy_"+e);if(c.find(" .scoreAnimate").fadeIn().animate({top:"30px"},"normal").fadeOut(300),c.find(" .scoreTotal em").length>0)var r=parseInt($.trim(c.find(" .scoreTotal em").html()));else var s=c.find(" .scoreTotal").text(),l=s.split(" "),r=parseInt(l[1]);var r=r+1;c.find(" .scoreTotal").html("<b>不值</b> "+r)}},zhi_detail_callback:function(t,e,i,o,a){var n,r=$("#rating_"+e),s=parseInt($.trim($("#rating_worthy_num").text())),l=parseInt($.trim($("#rating_unworthy_num").text()));1==o?($(r).find(".add").show().animate({top:"-30px"},600).fadeOut("slow",function(){$("#rating_worthy_num").html(s+1),$("#rating_all_num").html("已有 "+(s+l+1)+" 用户参与")}),n=(s+1)/(s+l+1)*100):($(r).find(".reduce").show().animate({top:"80px"},600).fadeOut("slow",function(){$("#rating_unworthy_num").html(l+1),$("#rating_all_num").html("已有 "+(s+l+1)+" 用户参与")}),n=s/(s+l+1)*100),r.find(" .progressing").css("width",n.toString()+"%")},zan_callback:function(t,e,i,o,a){$(a).find("span.addNumber").fadeIn().animate({top:"-35px"},"normal").fadeOut(300),$(a).attr("class","zan current"),zhiyou_relate.scored("#details-zan","current"),$(a).find("em").length>0?$(a).find("span.scoreAnimate").fadeIn().animate({top:"-35px"},"normal").fadeOut(300,function(){$(a).find("em").html(Number($(a).find("em").html())+1)}):$(a).parents(".show_exp_zan").find("em").length>0?$(a).parents(".show_exp_zan").find("em").html(Number($(a).parents(".show_exp_zan").find("em").html())+1):$(a).parents(".show_exp_zan").find(".grey").html("已有<em>1</em>人赞过")},add_rating:function(t,e,i,o,a){var n=this;if("zan"==t){var r=n.zan_callback;$(a).removeAttr("onclick"),$(a).css("cursor","default")}else if("zhi_list"==t){var r=n.zhi_list_callback,s=$("#rating_worthy_"+e),l=$("#rating_unworthy_"+e);s.removeAttr("onclick").css("cursor","default"),l.removeAttr("onclick").css("cursor","default"),1==o?(s.addClass("current").addClass("worthCurrent"),l.addClass("unworthCurrent")):(s.addClass("worthCurrent"),l.addClass("current").addClass("unworthCurrent"))}else if("zhi_in"==t){var r=n.zhi_detail_callback,s=($("#rating_"+e),$("#rating_worthy")),l=$("#rating_unworthy");s.removeAttr("onclick").css("cursor","default").addClass("worthCurrent"),l.removeAttr("onclick").css("cursor","default").addClass("unworthCurrent"),zhiyou_relate.scored("#details-zhi","worthCurrent"),zhiyou_relate.scored("#details-buzhi","unworthCurrent")}$.ajax({type:"get",url:n.baseUrl+"user/rating/jsonp_add",data:{article_id:e,channel_id:i,rating:o},dataType:"jsonp",jsonp:"callback",success:function(t){r(t,e,i,o,a)},error:function(){}})},init_rating_by_cookie:function(){for(var t=[0,3,6,7,8,9,10,11,16],e=1,i=t.length;i>e;e++){var o=t[e],a="smzdm_rating_"+o,n=getCookie(a);n&&(rating_cookie=json_decode(n),3==o?($(".lrBot").length&&$(".lrBot").each(function(){if("undefined"!=typeof $(this).find(" .good").attr("id")){var t=$(this).find(" .good").attr("id").split("_")[2];if(t in rating_cookie){var e=$("#rating_worthy_"+t);if(e.length>0){var i=$("#rating_unworthy_"+t);e.removeAttr("onclick"),i.removeAttr("onclick"),1==rating_cookie[t]?(e.addClass("current").css("cursor","default").addClass("worthCurrent"),i.css("cursor","default").addClass("unworthCurrent")):-1==rating_cookie[t]&&(e.css("cursor","default").addClass("worthCurrent"),i.addClass("current").css("cursor","default").addClass("unworthCurrent"))}}}}),$(".zan_fav_com").length&&$(".zan_fav_com").each(function(){if("undefined"!=typeof $(this).find(" .zan").attr("id")){var t=$(this).find(" .zan").attr("id").split("_")[2];if(t in rating_cookie){var e=$("#rating_worthy_"+t);e.length>0&&(e.removeAttr("onclick"),1==rating_cookie[t]&&e.addClass("current").css("cursor","default"))}}}),$(".score_rateBox").each(function(){if("undefined"!=typeof $(this).attr("id")){var t=$(this).attr("id").split("_")[1];if(t in rating_cookie){var e=$("#rating_worthy");if(e.length>0){var i=$("#rating_unworthy");e.removeAttr("onclick").css("cursor","default"),i.removeAttr("onclick").css("cursor","default"),e.addClass("worthCurrent"),i.addClass("unworthCurrent"),scored("#details-zhi","worthCurrent"),scored("#details-buzhi","unworthCurrent")}}}})):$(".zan").each(function(){var t=$(this).attr("id");if("undefined"!=typeof t){var e=t.split("_"),i=e[3],a=e[2];7==a?a=8:8==a&&(a=7),o==a&&i in rating_cookie&&($(this).attr("class","zan current"),$(this).removeAttr("onclick"),$(this).css("cursor","default"))}}))}}};zhiyou_relate.setCookie=function(t,e,i,o,a,n){i=i?i:604800,i=1e3*i;var r=new Date;r.setTime(r.getTime()+i),document.cookie=encodeURIComponent(t)+"="+encodeURIComponent(e)+(r?"; expires="+r.toGMTString():"")+(o?"; path="+o:"/")+(a?"; domain="+a:"")+(n?"; secure":"")},zhiyou_relate.footer_login_layer_init=function(){function t(t,e){"undefined"!=typeof $(r)&&$(r)&&$(r).length>=0&&$(r).remove(),$("#footer").after(t),1==e&&"undefined"!=typeof dataLayer&&dataLayer.push({event:"virtualPageview",page:i}),2==e&&"undefined"!=typeof ga&&(v&&"undefined"!=typeof v?ga("send","event","专题活动",v+"_评论浮层","展现"):ga("send","event","专题活动","专题活动_评论浮层","展现")),$(r).show(),$(".close_footer_layer").click(function(){$(this);$(r).hide(),zhiyou_relate.setCookie(s,"1",604800,"/",".smzdm.com")})}var e=".footer_login_layer",i=$(e).data("login_layer_show_gtm"),o=$(e).data("click_login_gtm"),a=$(e).data("click_register_gtm"),n=$(e).data("click_close_gtm"),r="#footer_layer",s="has_show_login_layer",l='<div class="footer-layer" id="footer_layer" style="display:none"><div class="layer-center"><div class="layer-left"><ul><li><img src="http://res.smzdm.com/images/zhiyou/material/footer_login_layer.png"/></li><li><button class="Login zhiyou_login" onclick="dataLayer.push({\'event\':\''+o+"'})\">登录</button></li><li><button class=\"register\" onclick=\"window.open('http://zhiyou.smzdm.com/user/register/mobile','_blank');dataLayer.push({'event':'"+a+'\'})" >注册</button></li></ul></div><div class="layer-right" id="del_layer"><i class="icon-cross-lighter close_footer_layer" onclick="dataLayer.push({\'event\':\''+n+"'})\"></i></div></div></div>",c=getCookie(s),d=window.location.hash,m=window.location.hostname,p=window.location.pathname,u="详情页";switch(m){case"news.smzdm.com":u="资讯详情";break;case"post.smzdm.com":u="原创详情";break;case"wiki.smzdm.com":u="百科详情";break;case"2.smzdm.com":u="二手详情";break;case"www.smzdm.com":u=0==p.indexOf("/zhuanti/")?"专题详情":"优惠详情";break;case"test.smzdm.com":u=0==p.indexOf("/pingce/p")?"评测详情":"众测详情"}var _="dataLayer.push({'event':'"+u+"_评论_浮层登录'});",h="dataLayer.push({'event':'"+u+"_评论_浮层注册'});",f="dataLayer.push({'event':'"+u+"_评论_浮层关闭'});",v=$("#footer_nologin_comment_layer").data("title");v&&"undefined"!=typeof v&&(_="ga('send', 'event', '专题活动', '"+v+"_评论浮层', '登录');",h="ga('send', 'event', '专题活动', '"+v+"_评论浮层', '注册');",f="ga('send', 'event', '专题活动', '"+v+"_评论浮层', '关闭');");var g='<div class="footer-layer" id="footer_layer" style="display:none"><div class="layer-center"><div class="layer-left"><ul><li><img src="http://res.smzdm.com/images/zhiyou/material/footer_comment_login_layer.png"/></li><li><button class="Login zhiyou_login" onclick="'+_+"\">登录</button></li><li><button class=\"register\" onclick=\"window.open('http://zhiyou.smzdm.com/user/register/mobile','_blank');"+h+'" >注册</button></li></ul></div><div class="layer-right" id="del_layer"><i class="icon-cross-lighter close_footer_layer" onclick="'+f+'"></i></div></div></div>';return"1"==c?!1:$(e).length<=0?void(0==d.indexOf("#comments")&&t(g,2)):void t(l,1)},zhiyou_relate.init(),zhiyou_relate.extra_user_info_callback=function(t){};var smzdm_domain=".smzdm.com",comment_report_cookiename="comment_report";window.comment_report_cookie_list;var comment_rating_cookiename="comment_rating";window.comment_rating_cookie_list;var StringBuilder=function(t){this.s=new Array(t),this.onMultiAppendBeforeHandle=null,this.onMultiAppendBefore=function(t){return this.onMultiAppendBeforeHandle=t,this},this.append=function(t){return this.s.push(t),this},this.toString=function(){return this.s.join("")},this.clear=function(){this.s=new Array},this.appendMultiFormat=function(t,e){if("object"==typeof e)for(var i in e)null!=this.onMultiAppendBeforeHandle&&this.onMultiAppendBeforeHandle(e[i]),this.appendFormat(t,e[i]);return this},this.appendFormat=function(){var t=arguments.length;if(0==t)return this;var e=arguments[0];if(1==t)return this.append(e);var i=arguments[1];null==i&&(i="");var o,a,n,r,s;for(s="object"==typeof i?function(t,e){return t[1][e]}:function(t,e){return t[e-0+1]},o=0;o<e.length;)n=e.charAt(o),"{"!=n?(this.s.push(n),o++):(a=e.indexOf("}",o),r=e.substring(o+1,a),this.s.push(s(arguments,r)),o=a+1);return this}};$.fn.autoTextarea=function(t){if($("#quickReply")){var e={maxHeight:null,minHeight:$(this).height()},i=$.extend({},e,t);$(this).bind("paste cut keydown keyup focus blur",function(){var t,e=this.style;this.style.height=i.minHeight+"px";var o=$(this).css("padding-top").split("",1),a=parseInt(o);this.scrollHeight>i.minHeight&&(i.maxHeight&&this.scrollHeight>i.maxHeight?(t=i.maxHeight-a,e.overflowY="scroll"):(t=this.scrollHeight-a,e.overflowY="hidden"),e.height=t-a+"px")})}},$(function(){function countdown(){wait>0?($submit.html(wait),wait--,setTimeout(countdown,1e3)):($submit.html(submit_val).attr("disabled",!1).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1),wait=_time_slicing)}function quickcountdown(){waitquick>0?($submitQuickBtn.html(waitquick),waitquick--,setTimeout(quickcountdown,1e3)):($submitQuickBtn.html(quick_submit_val).attr("disabled",!1).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1),waitquick=_time_slicing)}function count_down(t){var e=parseInt($(t).html());e>0&&($(t).html(e-1),setTimeout(function(){count_down(t)},1e3)),0==e&&($(".sub_Success").fadeOut(),$("#cover").fadeOut())}function submit_comment(isQuickSumit){var errorContainerId="error",btn=$submit,loadingImg=$("#loading");if(1==isQuickSumit){var formObj=$("#commentquickform");errorContainerId="quick_error",btn=$submitQuickBtn,loadingImg=$("#loadingquick")}else var formObj=$("#commentform");btn.attr("disabled",!0).removeClass("btn_sub").addClass("btn_subGrey").fadeTo("slow",1),loadingImg.show(),$.ajax({url:zhiyou_relate.baseUrl+"user/comment/ajax_set_comment",data:formObj.serialize(),dataType:"jsonp",jsonp:"callback",success:function(data){var result=eval(data);if(loadingImg.hide(),10==result.error_code)return void(result.error_msg.sina_uri?($("#pop-status-fail").find(".pop_info").html(txt10),$("#pop-status-fail").find(".icon-logintanhao").css({"float":"left","margin-left":"15px","margin-top":"15px"}),$("#pop-status-fail").fadeIn(),$("#cover").fadeIn(),popPosition("#pop-status-fail"),count_down("#goback"),setTimeout(function(){window.location.href=result.error_msg.sina_uri},4e3)):setTimeout(function(){btn.attr("disabled",!1).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1),$("#"+errorContainerId).slideUp()},3e3));if(0==result.error_code){var div_new=$(".comment_wrap .tab_nav").find(".tab_comment_li:first");if(div_new.siblings().removeClass("current_item"),div_new.addClass("current_item"),$("#commentTabBlockNew").css("display",""),$("#commentTabBlockHot").css("display","none"),result.error_msg.sina_uri)return void(window.location.href=result.error_msg.sina_uri);var the_floor=0,floor_grey=$("#commentTabBlockNew ul.comment_listBox li:first .grey").html();floor_grey&&(the_floor=floor_grey.split("楼")[0]),the_floor=the_floor?parseInt(the_floor)+1:0;var ok_htm='\n<div id="success_1'+txt3+"</div>\n";6==result.error_code?ok_htm='\n<div id="success_1'+txt4+"</div>\n":8==result.error_code&&(ok_htm='\n<div id="success_1'+txt8+"</div>\n");var new_comment_html="";new_comment_html+='<li id="li_comment_4700621" class="comment_list">',new_comment_html+='<div class="comment_avatar">',new_comment_html+='<a href="javascript:void(0);" class="userPic"><img src="'+result.error_msg.head+'" width="36" height="36"/></a>',new_comment_html+=the_floor?'<span class="grey">'+the_floor+"楼</span>":"",new_comment_html+="</div>",new_comment_html+='<div class="comment_conBox">',new_comment_html+='<div class="comment_avatar_time"><div class="time">'+result.error_msg.format_date+"</div>",new_comment_html+=result.error_msg.is_anonymous?'<span class="grey">'+result.error_msg.display_name+"</span>":'<a href="javascript:void(0);" class="a_underline user_name">'+result.error_msg.display_name+"</a>",new_comment_html+="</div>",new_comment_html+='<div class="comment_conWrap">',new_comment_html+='<div class="comment_con"><p>'+result.error_msg.comment_content+"</p></div>",new_comment_html+=ok_htm,new_comment_html+='<div class="blankDiv"></div>',new_comment_html+="</div>",new_comment_html+="</div>",new_comment_html+='<div class="clear"></div>',new_comment_html+="</li>",$("#comment .tab_nav:first").css("display","block"),$("#li_comment_new").after(new_comment_html),setTimeout(function(){$("#success_1").remove()},3e3),1==isQuickSumit?quickcountdown():countdown(),1==isQuickSumit?$("#quickComment").val(""):$("#textareaComment").val(""),cancle_vote(),$(".commentNum").each(function(){$(this).html(parseInt($(this).html())+1)}),$("#quickComment").height("auto");var score=result.error_msg.post_points?result.error_msg.post_points:0,exp=result.error_msg.post_experience?result.error_msg.post_experience:0,gold=result.error_msg.post_gold?result.error_msg.post_gold:0,mana=result.error_msg.post_prestige?result.error_msg.post_prestige:0;if(0!=score||0!=exp||0!=gold||0!=mana){var scoreDom=0==score?"":'<span class="comment_score">积分：<em>'+score+"</em></span>",expDom=0==exp?"":'<span class="comment_exp">经验：<em>'+exp+"</em></span>",goldDom=0==gold?"":'<span class="comment_gold">金币：<em>'+gold+"</em></span>",manaDom=0==mana?"":'<span class="comment_mana">威望：<em>'+mana+"</em></span>";$("#pop-comment-score").find(".pop_comment_info").html(scoreDom+expDom+goldDom+manaDom),popUp("","#pop-comment-score","成功发表评论")}$("#"+errorContainerId).is(":hidden")&&$("#"+errorContainerId).html(ok_txt).css("color","green").slideDown().delay(3e3).slideUp()}else if(7==result.error_code){var msg=result.error_msg;$("body").append('<div class="pop pop_no_title" id="pop-scorenotenough"><i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i><div class="pop-content oneLine"><i class="icon-logintanhao"><!--[if lt IE 8]>404<![endif]--></i><p class="pop_info"></p></div></div>'),popUp("","#pop-scorenotenough",msg)}else{var no_htm=result.error_msg;5==result.error_code&&(no_htm="请登录后发表评论"),$("#"+errorContainerId).slideDown().html(no_htm),setTimeout(function(){btn.attr("disabled",!1).removeClass("btn_subGrey").addClass("btn_sub").fadeTo("slow",1),$("#"+errorContainerId).slideUp()},3e3)}}})}showHide(".downloadApp","",".more-share-box"),document.onkeydown=function(t){var e=null;if(e=window.event?window.event:t,null!=e&&e.ctrlKey&&13==e.keyCode){var i=$("#quickComment").is(":focus"),o=$("#textareaComment").is(":focus"),a=$("#choujiangComment").is(":focus");1==o&&$("#textCommentSubmit").click(),1==i&&$("#textCommentSubmitQuick").click(),1==a&&$("#choujiangCommentSubmit").click()}},commentQuickReply(".reply"),showHide(".comment_list","",".jubao"),visibleOrNot(".operate_box",".noGoods","visibility"),visibleOrNot("blockquote",".comment_action","display"),tab(".tab_comment_li",".tab_info","current_item","click"),openClose(".seaAll","","comments"),openClose("a.more","a.pickup","mallNav"),$("#textareaComment, .comment_tips").addClass("zhiyou_login"),comment_share_to_sina("i.check"),$(".textarea_quick").height("auto");var quickComment_obj=$("#quickComment");quickComment_obj.length&&(quickComment_obj.val(""),quickComment_obj.autoTextarea({maxHeight:200}));var ok_txt="评论成功，稍后在页面中显示。每日前三条评论还加经验哦！",txt3='"><i class="icon-loginright"></i> '+ok_txt,txt4='"><i class="icon-loginright"></i> '+ok_txt,txt5='"><i class="icon-loginright"></i> 为维护良好讨论环境，新注册用户的评论需人工审核后再显示，请谅解',txt8='"><i class="icon-loginright"></i> <span class="red">你的投票已超过次数限制或未达到投票权限，该评论仅作为普通评论</span>',txt10='评论同步新浪微博失败，您尚未绑定微博账号，<span class="red" id="goback">4</span>秒后将带您进入微博授权页',$submit=$("#commentform #textCommentSubmit"),$submitQuickBtn=$("#commentquickform #textCommentSubmitQuick");$submit.attr("disabled",!1),$submitQuickBtn.attr("disabled",!1),$("#commentform").submit(function(){return""==$.trim($("#textareaComment").val())||$.trim($("#textareaComment").val())==$("#textareaComment").attr("default_data")?$("#error").is(":hidden")&&$("#error").html("您是不是忘了说点什么？").slideDown().delay(3e3).slideUp():submit_comment(0),!1}),$("#commentquickform").submit(function(){return""==$.trim($("#quickComment").val())||$.trim($("#quickComment").val())==$("#textareaComment").attr("default_data")?$("#quick_error").is(":hidden")&&$("#quick_error").html("您是不是忘了说点什么？").slideDown().delay(3e3).slideUp():submit_comment(1),!1});var _time_slicing=10,wait=_time_slicing,submit_val=$submit.html(),waitquick=_time_slicing,quick_submit_val=$submitQuickBtn.html();func_atta(),func_report()}),function(t){t.fn.extend({insertContent:function(e,i){var o=t(this)[0];if(document.selection){this.focus();var a=document.selection.createRange();a.text=e,this.focus(),a.moveStart("character",-r);var n=a.text.length;if(2==arguments.length){var r=o.value.length;a.moveEnd("character",n+i),0>=i?a.moveStart("character",n-2*i-e.length):a.moveStart("character",n-i-e.length),a.select()}}else if(o.selectionStart||"0"==o.selectionStart){var s=o.selectionStart,l=o.selectionEnd,c=o.scrollTop;o.value=o.value.substring(0,s)+e+o.value.substring(l,o.value.length),this.focus(),o.selectionStart=s+e.length,o.selectionEnd=s+e.length,o.scrollTop=c,2==arguments.length&&(o.setSelectionRange(s-i,o.selectionEnd+i),this.focus())}else this.value+=e,this.focus()}})}(jQuery);var comment_tpl={item:'<blockquote class="comment_blockquote" blockquote_cid="{comment_id}"><div class="comment_floor">{depth}</div><div class="comment_conWrap"><div class="comment_con">{user_display_name}</div><div class="comment_action"><a class="jubao" href="javascript:void(0);" id="report_{comment_id}">举报</a><a class="dingNum {ding_class}" href="javascript:void(0);" id="cdc_support_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 1, {comment_id}, {article_id}, {li_comment_id});">顶<span>({up_num})</span></a><a class="caiNum" href="javascript:void(0);" id="cdc_oppose_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 0, {comment_id}, {article_id}, {li_comment_id});">踩<span>({down_num})</span></a>{atta}<a class="reply" href="javascript:void(0);" id="cdc_reply_{comment_id}">回复</a></div><div class="blankDiv"></div></div></blockquote>',item_no_atta_reply:'<blockquote class="comment_blockquote" blockquote_cid="{comment_id}"><div class="comment_floor">{depth}</div><div class="comment_conWrap"><div class="comment_con">{user_display_name}</div><div class="comment_action"><a class="jubao" href="javascript:void(0);" id="report_{comment_id}">举报</a><a class="dingNum {ding_class}" href="javascript:void(0);" id="cdc_support_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 1, {comment_id}, {article_id}, {li_comment_id});">顶<span>({up_num})</span></a><a class="caiNum" href="javascript:void(0);" id="cdc_oppose_{comment_id}" onclick="return comment_rating_ajax(\'{comment_type}\', 0, {comment_id}, {article_id}, {li_comment_id});">踩<span>({down_num})</span></a></div><div class="blankDiv"></div></div></blockquote>'};$(function(){tabCommon(".innerlink-title","span",".innerlink-content","active","hover")}),$(document).ready(function(){var t={init:function(){if(!$("#rewardOptions")[0]||!$("#rewardModule")[0])return!1;switch(this.articleId=$("#rewardOptions").attr("data-articleId"),this.autherId=$("#rewardOptions").attr("data-autherId"),this.avatarImg=$("#rewardOptions").attr("data-avatarImg"),this.autherName=$("#rewardOptions").attr("data-autherName"),this.channelId=$("#rewardOptions").attr("data-channelId"),this.articleTitle=$("#rewardOptions").attr("data-articleTitle")+"",this.channelText="",this.cache_text="",this.auther_call="",this.channelId){case"3":this.title="优惠很值，打赏犒劳爆料人一下",this.channelText="优惠",this.cache_text="爆料",this.auther_call="爆料人";break;case"8":this.title="文章很值，打赏犒劳作者一下",this.channelText="评测",this.cache_text="创作",this.auther_call="作者"}this.pageNum=10,this.avatarLength=5,this.topLength=3,this.jsonData(1),this.showPageNum=5,this.insertCss("http://res.smzdm.com/resources/public/css/gratuity_plug.css")},jsonData:function(t){var e=this;$.ajax({url:"http://zhiyou.smzdm.com/user/shang/jsonp_shang_list?channel_id="+e.channelId+"&article_id="+e.articleId+"&get_total=1&with_top=1&page="+t+"&limit="+e.pageNum,type:"get",dataType:"jsonp",jsonp:"callback",success:function(t){e.Data=t,e.insertDom(),e.inserAction()},error:function(t){}})},isElement:function(t){return"undefined"!=typeof t&&t.length>=1?!0:!1},insertCss:function(t){try{document.createStyleSheet(t)}catch(e){var i=document.createElement("link");i.rel="stylesheet",i.type="text/css",i.href=t;var o=document.getElementsByTagName("head")[0];o.appendChild(i)}},insertDom:function(){var t=this,e=[];"优惠"==this.channelText?e.push('<div class="reward-box" style="border:0">'):e.push('<div class="reward-box" >'),e.push("<p>"+this.title+"</p>"),e.push("<div>"),$.ajax({url:"http://zhiyou.smzdm.com/user/info/jsonp_get_current/",type:"get",dataType:"jsonp",jsonp:"callback",success:function(i){var o=""+zhiyou_relate.user_info.smzdm_id;t.autherId=""+t.autherId,o==t.autherId?e.push('<a class="reward-btn-no" href="javascript:void(0)">打赏</a>'):e.push('<a class="reward-btn" href="javascript:void(0)">打赏</a>');var i=t.Data.data;if(0!=i.total){e.push('<ul class="reward-head-portrait">');for(var a=i.rows.length<=t.avatarLength?i.rows.length:t.avatarLength,n=0;a>n;n++){var r=i.rows[n].avatar,s=i.rows[n].nickname,l=i.rows[n].user_url,c=i.rows[n].beauty_time,d=i.rows[n].smzdm_id;e.push('<li><a href="'+l+'"><img id="'+d+'" src="'+r+'" name="'+s+'" time="'+c+'"></a></li>')}e.push("</ul>")}0==i.total?e.push('<span id="reward-list-msg" data-limit="10">“首席”打赏官正虚席以待！</span>'):i.total>10?e.push('<span>等<a class="gratuity-num">'+i.total+"</a>人已打赏</span>"):e.push('<span><a class="gratuity-num">'+i.total+"</a>人已打赏</span>"),e.push('<div class="clearfix"></div>'),e.push("</div>"),e.push("</div>");var m=e.join("");$("#rewardModule").html(m),$("#rewardModule").show(),$("article.general_bg").css("margin-bottom","0px"),$("#rewardModule").css("padding-top","10px")},error:function(t){}})},inserAction:function(){function t(t,e){function i(){window.innerHeight?winHeight=window.innerHeight:document.body&&document.body.clientHeight&&(winHeight=document.body.clientHeight);var i=$(t).height();$(e).css("top",(winHeight-i)/2+"px")}i(),window.onresize=i}function e(t,e){for(var i=e.rows.length,a=0;i>a&&!(a>=o.pageNum);a++){var n=e.rows[a].avatar,r=e.rows[a].nickname,s=e.rows[a].user_url,l=e.rows[a].beauty_time;t.push("<li>"),t.push('<a href="'+s+'" target="_blank">'),t.push('<img src="'+n+'">'),t.push("</a>"),t.push('<p><a href="'+s+'">'+r+"</a></p>"),t.push("<span>"+l+"</span>"),t.push("</li>")}return t}function i(t,i){var a=t||i,n=o.pageNum;$.ajax({url:"http://zhiyou.smzdm.com/user/shang/jsonp_shang_list?channel_id="+o.channelId+"&article_id="+o.articleId+"&get_total=0&with_top=1&page="+a+"&limit="+n,type:"get",dataType:"jsonp",jsonp:"callback",success:function(i){function n(){var t=[];t.push('<li class="pageup"><span>&lt;</span><a>上一页</a></li>');for(var e=o.pageTotal>o.showPageNum?o.showPageNum:o.pageTotal,i=0;e>i;i++)t.push('<li><a page="'+(i+1)+'">'+(i+1)+"</a></li>");o.pageTotal>o.showPageNum&&t.push('<li><span class="dotStyle">...</span></li>'),t.push('<li class="pagedown"><a>下一页</a><span>&gt;</span></li>'),t.join(""),l.html(t)}var r=i.data,s=[];s=e(s,r),s=s.join(""),$("#gratuity-list-box div.pop-interval-30 ul.gratuity_list").html(s);var l=$("#gratuity-list-box ul.pagination"),c=l.find("li a.pageCurrent").attr("page"),d=l.find("li.pageup"),m=l.find("li.pagedown");if(l.find("li a.pageCurrent").removeClass("pageCurrent"),t)t>0&&t<=o.showPageNum&&(n(),1==t&&l.find(".pageup").remove(),t==o.pageTotal&&l.find(".pagedown").remove()),l.find('li a[page="'+t+'"]').addClass("pageCurrent");else{if(a>c){if(!d[0]){var p='<li class="pageup"><span>&lt;</span><a>上一页</a></li>';l.find("li").eq(0).before(p)}if(a>0&&a<=o.showPageNum&&o.pageTotal==a&&m.remove(),a>o.showPageNum&&a<=o.pageTotal){var u=l.find("li a[page]");a==o.showPageNum+1&&(u[1].outerHTML='<span class="dotStyle">...</span>',u=l.find("li a[page]"));for(var _=!1,h=0;h<u.length;h++)u.eq(h).attr("page")==a&&(_=!0);if(!_)for(var f=0;f<u.length;f++)if(1!=u.eq(f).attr("page")){var v=u.eq(f).attr("page");u.eq(f).attr("page",+v+1).html(+v+1)}return l.find('li a[page="'+a+'"]').addClass("pageCurrent"),o.pageTotal==a&&(m.remove(),l.find("li").eq(l.find("li").length-1).remove()),!1}}else if(c>a){if(o.showPageNum<a&&a<=+o.pageTotal-(o.showPageNum-2)){if(!m[0]){l.append('<li><span class="dotStyle">...</span></li>');var p='<li class="pagedown"><a>下一页</a><span>&gt;</span></li>';l.append(p)}for(var u=l.find("li a[page]"),_=!1,h=0;h<u.length;h++)u.eq(h).attr("page")==a&&(_=!0);if(!_)for(var f=0;f<u.length;f++)if(1!=u.eq(f).attr("page")){var v=u.eq(f).attr("page");u.eq(f).attr("page",+v-1).html(+v-1)}}a>0&&a<=o.showPageNum&&(n(),1==a&&l.find(".pageup").remove())}l.find('li a[page="'+a+'"]').addClass("pageCurrent")}},error:function(t){}})}var o=this;$("body").on("mouseover",".reward-head-portrait li",function(){var t=document.createElement("div");t.className="head-name";var e=$(this).find("img").attr("name"),i=$(this).find("img").attr("time");t.innerHTML="<em></em><p>"+e+'</p><p class="time">'+i+"</p>",t.style.top="-64px",$(this).append(t);var o=$(".head-name").width()/2;$(".head-name").css("left",0-o-5+"px"),$(".head-name").find("em").css("left",o+10+"px")}),$("body").on("mouseout",".reward-head-portrait li",function(){$(this).find("div.head-name").remove()}),$("body").on("click",".reward-btn",function(){$.ajax({url:"http://zhiyou.smzdm.com/user/info/jsonp_get_current/",type:"get",dataType:"jsonp",jsonp:"callback",success:function(e){var i=e;if(0==i.smzdm_id)return $("#pop-login-new").show(),$("#cover").show(),$("#zhiyou_login_window_iframe").attr("src",zhiyou_relate.iframe_url),!1;var a=[];a.push('<div class="pop pop_main_box" id="gratuity">'),a.push('<i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i>'),a.push('<div class="pop-title">'),a.push('<div class="pop_name">打赏</div>'),a.push("</div>"),a.push('<div class="pop-content" style="padding-bottom:0">'),a.push('<div class="pop-interval-30">'),a.push('<div class="pop-slogan">'),a.push('<a href="http://zhiyou.smzdm.com/member/'+o.autherId+'"><img class="pop-slogan-img" src="'+o.avatarImg+'"></a> 您的支持将鼓励我继续'+o.cache_text+"！"),a.push("</div>"),a.push('<div class="gratuity-process">'),a.push('<div class="gratuity-option">'),a.push('<span class="pop_jubao">'),a.push('<input type="radio" checked="" class="normal" id="broken_silver" name="report">'),a.push('<label for="broken_silver" class="color-gray"><span>碎银子</span>（余额 '+i.silver+"）</label>"),a.push("</span>"),a.push('<span class="pop_jubao">'),a.push('<input type="radio" class="normal" id="gold" name="report">'),
a.push('<label for="gold" class="color-gray"><span>金币</span>（余额 '+i.gold+"）</label>"),a.push("</span>"),a.push("</div>"),a.push("打赏数额"),a.push('<div class="broken_silver gratuity-option-box">'),a.push('<div class="gratuity-price">'),a.push("<ul>"),a.push('<li value="10">10碎银子</li>'),a.push('<li value="50">50碎银子</li>'),a.push('<li value="100">100碎银子</li>'),a.push("</ul>"),a.push('<input class="custom" value="" placeholder="可输入10的倍数">'),a.push("<span>碎银子</span>"),a.push('<div class="clear"></div>'),a.push("</div>"),a.push("</div>"),a.push('<div class="gold gratuity-option-box">'),a.push('<div class="gratuity-price">'),a.push("<ul>"),a.push('<li value="1">1金币</li>'),a.push('<li value="5">5金币</li>'),a.push('<li value="10">10金币</li>'),a.push("</ul>"),a.push('<input class="custom" value="" placeholder="输入数字为整数">'),a.push("<span>金币</span>"),a.push('<div class="clear"></div>'),a.push("</div>"),a.push("</div>"),a.push('<p class="color-gray">注：碎银子将以10:1的比例转为金币送给'+o.auther_call+"</p>"),a.push("</div>"),a.push('<div class="gratuity-success">');var n=o.articleTitle.length>25?o.articleTitle.substr(0,25)+"...":o.articleTitle;a.push("<p> 即将对"+o.channelText+"的"+o.auther_call+" "+o.autherName+" 的文章《"+n+'》进行打赏。<br><span class="gratuityOver"></span></p>'),a.push("</div>"),a.push('<a href="javascript:void(0)" class="a_redBlock gratuity-btn">打&nbsp;&nbsp;赏</a>'),a.push('<a href="javascript:void(0)" class="a_redBlock gratuity-ok" style="display:none">确&nbsp;&nbsp;认</a>'),a.push('<div class="pop_msg_error"></div>'),a.push("</div>"),a.push("</div>"),a.push("</div>"),$("#cover")[0]||a.push('<div id="cover"></div>');var r=a.join("");$("body").append(r),$("#cover").show(),$("#gratuity").show(),t("#gratuity","#gratuity");var s={broken_silver:0,gold:0};i.silver>0?($(".broken_silver ul").find("li").eq(0).addClass("hover"),s.broken_silver=parseInt($(".broken_silver ul").find("li").eq(0).attr("value"))):0==i.silver&&i.gold>0?($("#gold").attr("checked","checked"),$(".gold.gratuity-option-box").show(),$(".broken_silver.gratuity-option-box").hide(),$(".gold ul").find("li").eq(0).addClass("hover"),s.gold=parseInt($(".gold ul").find("li").eq(0).attr("value"))):0==i.silver&&0==i.gold&&(s.broken_silver=parseInt($(".broken_silver ul").find("li").eq(0).attr("value")),$(".gratuity-btn").attr("class","a_greyBlock  gratuity-btn"));var l=function(){$(".gratuity-price ul li").removeClass("hover"),$("#gratuity input.custom").removeClass("input-error")};$(".gratuity-option span.pop_jubao").click(function(){0==this.getElementsByTagName("input")[0].checked&&(this.getElementsByTagName("input")[0].checked="checked");var t=$(this).find("input").attr("id"),e=function(t,e){i[t]>e?$(".gratuity-btn").attr("class","a_redBlock gratuity-btn"):$(".gratuity-btn").attr("class","a_greyBlock gratuity-btn")};s={broken_silver:0,gold:0},$("#gratuity input.custom").val(""),"broken_silver"==t?($(".gratuity-option-box").hide(),$(".broken_silver").show(),l(),$(".broken_silver ul").find("li").eq(0).addClass("hover"),s.broken_silver=parseInt($(".broken_silver ul").find("li").eq(0).attr("value")),$(".pop_msg_error").html(""),e("silver",10)):($(".gratuity-option-box").hide(),$(".gold").show(),l(),$(".gold ul").find("li").eq(0).addClass("hover"),s.gold=parseInt($(".gold ul").find("li").eq(0).attr("value")),$(".pop_msg_error").html(""),e("gold",1))});var c=function(){return $('.gratuity-option input[name="report"]:checked ').attr("id")};$(".gratuity-price ul li").click(function(){l(),$(this).addClass("hover"),s={broken_silver:0,gold:0},s[c()]=$(this).attr("value"),$(".pop_msg_error").html(""),$(".custom").val("");var t=($(".custom"),$(".pop_msg_error")),e=$(".gratuity-btn");"broken_silver"==c()?+$(this).attr("value")>+i.silver?(t.html("碎银子不足，您可以换个姿势打赏"),e.attr("class","a_greyBlock  gratuity-btn")):(t.html(""),e.attr("class","a_redBlock gratuity-btn")):+$(this).attr("value")>+i.gold?(t.html("金币不足，您可以换个姿势打赏"),e.attr("class","a_greyBlock  gratuity-btn")):(t.html(""),e.attr("class","a_redBlock gratuity-btn"))}),$(".gratuity-price input.custom").focus(function(){l(),s={broken_silver:0,gold:0}});var d=+i.silver,m=+i.gold;$(".gratuity-price input.custom").change(function(){var t=$(".custom"),e=$(".pop_msg_error"),i=$(".gratuity-btn");if($(".pop_msg_error").html(""),$(".gratuity-btn").attr("class","a_redBlock gratuity-btn"),""!=this.value){var o=c();if("broken_silver"==o){if(this.value>d)return t.addClass("input-error"),e.html("碎银子不足，您可以换个姿势打赏"),i.attr("class","a_greyBlock  gratuity-btn"),!1;if(0==this.value)return t.addClass("input-error"),e.html("碎银子打赏只支持10的倍数哦"),i.attr("class","a_greyBlock  gratuity-btn"),!1;var a=parseInt(this.value,10);if(a%10!=0)return t.addClass("input-error"),e.html("碎银子打赏只支持10的倍数哦"),i.attr("class","a_greyBlock  gratuity-btn"),!1;s.broken_silver=a,i.attr("class","a_redBlock gratuity-btn"),t.removeClass("input-error")}else if("gold"==o){if(this.value>m)return t.addClass("input-error"),e.html("余额不足，您可以换个姿势打赏"),i.attr("class","a_greyBlock  gratuity-btn"),!1;var n=/^[1-9]+[0-9]*]*$/,r=n.test(this.value);if(!r)return t.addClass("input-error"),e.html("金币打赏值只支持整数哦"),i.attr("class","a_greyBlock  gratuity-btn"),!1;s.gold=parseInt(this.value,10),i.attr("class","a_redBlock gratuity-btn"),t.removeClass("input-error")}}else t.addClass("input-error"),e.html("请输入打赏金额！"),i.attr("class","a_greyBlock  gratuity-btn")}),$(".gratuity-price input.custom").blur(function(){""==this.value&&($(".pop_msg_error").html("请输入打赏金额！"),$(".gratuity-btn").attr("class","a_greyBlock  gratuity-btn"))}),$(".gratuity-btn").click(function(){if($(this).attr("class").indexOf("a_redBlock")>-1){for(var t in s)if(0!=s[t]){var e=+s[t],a=function(){return 0!=s.broken_silver?2:1}();$(".gratuity-btn").hide(),$(".gratuity-ok").css("display","block"),$(".gratuity-process").hide(),$(".gratuity-success").show(),2==a?$("span.gratuityOver").html("打赏"+e+"碎银子，"+o.auther_call+"将收到"+e/10+"金币"):1==a&&$("span.gratuityOver").html("打赏"+e+"金币，"+o.auther_call+"将收到"+e+"金币"),$(".security-input").val(""),$(".pop_msg_error").html("");var n=+i.shang.day_has_shang_gold,r=+i.shang.day_shang_gold_limit,l=+i.shang.day_shang_per_gold_limit;if(2==a&&(e=+e/10),e>l||n+e>=r){$("input.security-input")[0]||$(".gratuity-success").append('<div><input type="text" value="" placeholder="请输入安全码" class="security-input"></div>'),$(".gratuity-ok").attr("class","a_redBlock gratuity-ok");var c;c=i.is_set_safepass?'<a target="_blank" href="http://zhiyou.smzdm.com/user/find_password/">忘记安全密码？</a>':'没有设置安全密码(<a target="_blank" href="http://zhiyou.smzdm.com/user/safepass/">设置安全密码</a>)',$(".pop_msg_error").html(c)}return!1}$(".pop_msg_error").html("您还没有选择打赏金额！")}}),$(".a_redBlock.gratuity-ok").click(function(){if($(this).attr("class").indexOf("a_redBlock")>-1){var e="",a=function(){for(var t in s)if(0!=s[t])return e=s[t],"broken_silver"==t?2:1}(),n="";if($(".security-input")[0]&&(n=$(".security-input")[0].value,""==n))return $("#gratuity .pop_msg_error").html('请输入安全密码(<a href="http://zhiyou.smzdm.com/user/find_password/" target="_blank">忘记安全密码</a>)'),!1;$.ajax({url:"http://zhiyou.smzdm.com/user/shang/jsonp_shang?style="+a+"&coin="+e+"&channel_id="+o.channelId+"&article_id="+o.articleId+"&safepass="+n,dataType:"jsonp",jsonp:"callback",success:function(e){if(0==e.error_code){$("#gratuity").remove();var a,n=[];if("优惠"==o.channelText?a=30:"评测"==o.channelText&&(a=40),n.push('<div class="pop pop_no_title gratuityOk" style="width: 300px; text-align: center; padding:'+a+'px 0;">'),n.push('<i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i>'),n.push('<div class="pop_jubao oneLine">'),n.push('<i class="icon-loginright"><!--[if lt IE 8]>√<![endif]--></i>'),n.push('<p class="pop_info">打赏成功</p>'),n.push("</div>"),n.push("</div>"),n=n.join(""),$("body").append(n),$("div.gratuityOk").show(),$(".reward-head-portrait")[0]){var r=[];r.push("<li>"),r.push('<a href="http://zhiyou.smzdm.com/member/'+i.smzdm_id+'/" _orighref="http://zhiyou.smzdm.com/member/'+i.smzdm_id+'/" _tkworked="true">'),r.push('<img id="'+i.smzdm_id+'" src="'+i.avatar+'" name="'+i.nickname+'" time="刚刚">'),r.push("</a>"),r.push("</li>"),r=r.join("");for(var s=$(".reward-head-portrait li").length,l=!1,c=0;s>c;c++)$(".reward-head-portrait").find("li").eq(c).find("img").attr("id")==i.smzdm_id&&(l=!0);if(l){$("#"+i.smzdm_id).parents("li").remove();var d=$(".reward-head-portrait").html();$(".reward-head-portrait").html(r+d)}else{s>=o.avatarLength?($(".reward-head-portrait").find("li").eq(s-1).remove(),$(".reward-head-portrait").find("li").eq(0).before(r)):$(".reward-head-portrait").find("li").eq(0).before(r);var m=+$("a.gratuity-num").html();$("a.gratuity-num").html(m+1),$("a.reward-top span").html(m+1)}}else{var r=[];r.push('<ul class="reward-head-portrait">'),r.push("<li>"),r.push('<a href="http://zhiyou.smzdm.com/member/'+i.smzdm_id+'/" _orighref="http://zhiyou.smzdm.com/member/'+i.smzdm_id+'/" _tkworked="true">'),r.push('<img src="'+i.avatar+'" name="'+i.nickname+'" time="刚刚">'),r.push("</a>"),r.push("</li>"),r.push("</ul>"),r.push('<span><a class="gratuity-num" _hover-ignore="1" _orighref="" _tkworked="true">1</a>人已打赏</span>'),r=r.join(""),$(".reward-btn").after(r),$("span#reward-list-msg").remove(),$("a.reward-top span").html("1")}$(".reward-head-portrait li").hover(function(){var t=document.createElement("div");t.className="head-name";var e=$(this).find("img").attr("name"),i=$(this).find("img").attr("time");t.innerHTML="<em></em><p>"+e+'</p><p class="time">'+i+"</p>",t.style.top="-64px",$(this).append(t);var o=$(".head-name").width()/2;$(".head-name").css("left",0-o-5+"px"),$(".head-name").find("em").css("left",o+10+"px")},function(){$(this).find("div.head-name").remove()}),$("body").on("click","div.gratuityOk i",function(){$(this).parent().remove()}),t("#gratuity-list-box","div.gratuityOk"),setTimeout(function(){$("div.gratuityOk").remove(),$("#cover").hide()},2e3)}else $(".pop_msg_error").html(e.error_msg)},error:function(t){},complete:function(t,e){"timeout"==e&&$("#gratuity .pop_msg_error").html("很抱歉，网络出了点小差，您可以再试")}})}});var p=function(){$(".gratuity-success").hide(),$(".gratuity-process").show(),$(".gratuity-option-box").hide(),$(".broken_silver").show(),$(".gratuity-btn").show(),$(".gratuity-ok").hide(),$(".pop_msg_error").html(""),$(".custom").val(""),l(),$(".gratuity-process ul").find("li").eq(0).addClass("hover"),$(".pop_jubao input").attr("checked",!1),document.getElementById("broken_silver").checked="checked"};$("body").on("click","span.back_gratuity",p)},error:function(t){}})}),$("body").on("click",".gratuity-num",function(){$.ajax({url:"http://zhiyou.smzdm.com/user/shang/jsonp_shang_list?channel_id="+o.channelId+"&article_id="+o.articleId+"&get_total=1&with_top=1&page=1&limit="+o.pageNum,type:"get",dataType:"jsonp",jsonp:"callback",success:function(i){o.Data=i;var a=o.Data.top_list,n=o.Data.data,r=[];if(r.push('<div class="pop pop_main_box" id="gratuity-list-box">'),r.push('<i class="pop-close icon-cross-lighter"><!--[if lt IE 8]>x<![endif]--></i>'),r.push('<div class="pop-title">'),r.push('<div class="pop_name">'+n.total+"人已对本文进行打赏</div>"),r.push("</div>"),r.push('<div class="pop-content" style="padding-bottom:0">'),r.push('<div class="pop-interval-30">'),0!=a.length&&n.total>=10){o.pageNum=5,r.push('<div class="gratuity_list_new">TOP 打赏</div>'),r.push('<ul class="gratuity_list_top">');for(var s=a.length>o.topLength?o.topLength:a.length,l=0;s>l;l++){r.push("<li>"),r.push('<span class="sort_value">'+(l+1)+"</span>"),r.push('<a href="'+a[l].user_url+'" target="_blank">'),r.push('<img src="'+a[l].avatar+'">'),r.push("</a>"),r.push('<span class="sort_txt"><a href="'+a[l].user_url+'">'+a[l].nickname+"</a></span>");var c=0==a[l].total_silver?"":"<span>"+a[l].total_silver+"</span> 碎银子　",d=0==a[l].total_gold?"":"<span>"+a[l].total_gold+"</span> 金币";r.push('<span class="gratuity_txt">打赏：'+c+d+"</span>"),r.push("</li>")}r.push("</ul>")}if(r.push('<div class="gratuity_list_new">最新打赏</div>'),r.push('<ul class="gratuity_list">'),r=e(r,n),r.push("</ul>"),r.push("</div>"),n.total>o.pageNum){r.push('<ul class="pagination">'),o.pageTotal=n.total%o.pageNum==0?n.total/o.pageNum:parseInt(n.total/o.pageNum,10)+1;for(var m=o.pageTotal>o.showPageNum?o.showPageNum:o.pageTotal,p=0;m>p;p++)0==p?r.push('<li><a class="pageCurrent" page="'+(p+1)+'">'+(p+1)+"</a></li>"):r.push('<li><a page="'+(p+1)+'">'+(p+1)+"</a></li>");o.pageTotal>1&&(o.pageTotal>o.showPageNum&&r.push('<li><span class="dotStyle">...</span></li>'),r.push('<li class="pagedown"><a>下一页</a><span>&gt;</span></li>')),r.push("</ul>")}r.push("</div>"),r.push("</div>");var u=r.join("");$("body").append(u),$("#cover")[0]||$("body").append('<div id="cover"></div>'),$("#cover").show(),$("#gratuity-list-box").show(),t("#gratuity-list-box","#gratuity-list-box")},error:function(t){}})}),$("body").on("click","#gratuity-list-box ul.pagination li a",function(){var t=$("#gratuity-list-box ul.pagination li a.pageCurrent").attr("page"),e=$(this).attr("page"),o=$(this).parent().attr("class");e&&null==o?t!=e&&i(e):e||"pagedown"!=o?e||"pageup"!=o||i(null,+t-1):i(null,+t+1)});for(var a=["#gratuity-list-box","#gratuity","div.gratuityOk"],n=0;n<a.length;n++)$("body").on("click",a[n]+" i.pop-close",function(){$(this).parent().remove(),$("#cover").hide()});$("body").on("click","#cover",function(){$("#gratuity-list-box")[0]&&$("#gratuity-list-box").remove(),$("#gratuity")[0]&&$("#gratuity").remove(),$("div.gratuityOk")[0]&&$("div.gratuityOk").remove(),$(this).hide()})}};t.init()});var HISTROY_NAME="s_his",HIS_DOMAIN=".smzdm.com";$(function(){function t(t){var e=getCookie(HISTROY_NAME);if(e){var i=e.split(","),o=$.inArray(t,i);o>-1&&i.splice(o,1),i.length>=10&&i.splice(0,1),setCookie(HISTROY_NAME,i.join(","),null,"/",HIS_DOMAIN)}setCookieInArr(HISTROY_NAME,t,null,"/",HIS_DOMAIN)}function e(t){var e=i(t);e.css("top",l.parent().outerHeight()),c.addClass("show-history").append(e),$(document).bind("click",function(t){a()}),c.on("click",function(t){t.stopPropagation()}),e.on("click",".s-history-head>a",function(t){deleteCookie(HISTROY_NAME),e.find(".s-history-list li").remove(),a()}),e.on("click","li>.J_his_remove",function(t){var e=$(this).parent("li"),i=decodeURIComponent(e.attr("data-val"));t.preventDefault(),t.stopPropagation(),deleteCookieInArr(HISTROY_NAME,i),e.remove()}),e.on("click",".s-history-list>li>a",function(t){var e=decodeURIComponent($(this).parent().attr("data-val"));l.val(e),c.trigger("submit")})}function i(t){var e={event:"站内搜索_历史搜索_清空"},i=$("<div/>",{"class":"s-history"}),a=$(['<div class="s-history-head">','<span class="grey">最近搜过</span><a href="javascript:;" onclick=\'dataLayer.push('+JSON.stringify(e)+");'>删除历史</a>","</div>"].join("")),n=o(t);return i.append(a).append(n)}function o(t){var e=$("<ul>",{"class":"s-history-list"});return $.each(t,function(t,i){var o={event:"站内搜索_历史搜索_点击","搜索字词":i},a={event:"站内搜索_历史搜索_删除","搜索字词":i},n=i;i.length>20&&(n=i.substr(0,20)+"...");var r=$("<li/>").attr("data-val",encodeURIComponent(i));r.append($("<a/>",{href:"javascript:;",onclick:"dataLayer.push("+JSON.stringify(o)+")"}).text(n)).append($("<span/>",{"class":"J_his_remove",onclick:"dataLayer.push("+JSON.stringify(a)+")"}).html("&times;")),e.prepend(r)}),e}function a(){var t=c.find(".s-history");c.removeClass("show-history"),t.length&&(t.hide(),t.find(".s-history-list>li.focus").removeClass("focus"))}function n(){var t=getCookie(HISTROY_NAME),i=c.find(".s-history");if(t&&0!==t.length){var o=t.split(",");c.addClass("show-history"),i.length?(r(o),i.show()):e(o)}}function r(t){var e=o(t);c.find(".s-history .s-history-list").replaceWith(e)}function s(t){window.dataLayer&&window.dataLayer.push({event:"站内搜索_历史搜索_点击","搜索字词":t})}var l=$('header form input[type="search"]'),c=l.closest("form").css("position","relative");"2.smzdm.com"==location.hostname?l.css("color","#fff"):l.css("color","#333"),$("header").on("submit","form",function(e){var i=$(this),o=$('input[name="default_keywords"]').val(),a=l.attr("name"),n=$.trim(l.val());if(n.length>0)return t(n),!0;if(e.preventDefault(),0===$.trim(o).length)return!1;var r=i.serializeArray(),s="";$.each(r,function(t,e){var i=0===t?"":"&";e.name==a&&(e.value=o),s+=i+e.name+"="+e.value}),window.location=i.get(0).action+"?"+s}),l.attr("autocomplete","off"),l.focus(function(t){var e=getCookie(HISTROY_NAME);!l.val().length&&e&&n()}).keyup(function(t){return t.keyCode>=37&&t.keyCode<=40?void t.preventDefault():void(l.val().length?a():n())}).keydown(function(t){c.hasClass("show-history")&&(t.keyCode>=37&&t.keyCode<=40?t.preventDefault():13===t.keyCode&&l.val().length&&s(l.val()))}),$(document).keyup(function(t){function e(t){var e=i.find(".s-history-list"),o=e.find("li.focus"),a=e.children().length-1;t=0>t?a:t>a?0:t,o.removeClass("focus");var n=decodeURIComponent(e.children().eq(t).addClass("focus").attr("data-val"));l.val(n)}var i=c.find(".s-history");if(!i.length||i.is(":hidden")||t.keyCode<37||t.keyCode>40)return!0;t.preventDefault(),t.stopPropagation();var o=i.find(".s-history-list"),n=o.find("li.focus");switch(t.keyCode){case 37:a();break;case 38:e(n.length?o.find("li.focus").index()-1:o.find("li").length-1);break;case 39:i.is(":visible")&&l.val().length&&c.trigger("submit");break;case 40:e(n.length?o.find("li.focus").index()+1:0)}})});